version: 0.1

android_test_host: amazon_linux_2

phases:
  install:
    commands:
      - echo "Installing Node.js v18.20.2..."
      - curl -O https://nodejs.org/dist/v18.20.2/node-v18.20.2-linux-x64.tar.xz
      - tar -xf node-v18.20.2-linux-x64.tar.xz
      - export PATH=$PWD/node-v18.20.2-linux-x64/bin:$PATH
      - echo 'export PATH=$PWD/node-v18.20.2-linux-x64/bin:$PATH' >> ~/.bashrc
      - node -v
      - npm -v

  pre_test:
    commands:
      - echo "Preparing test environment..."
      - source ~/.bashrc  # Re-apply updated PATH
      - cd $DEVICEFARM_TEST_PACKAGE_PATH
      - echo "Installing dependencies from package.json"
      - npm ci || npm install  # Use lock file if available

  test:
    commands:
      - echo "Running Appium + WDIO Tests"
      - pwd
      - ls -la
      - npx wdio run wdio.conf.ts || { echo "WDIO Test Run Failed"; exit 1; }

  post_test:
    commands:
      - echo "Test execution complete."

artifacts:
  - '*/.png'
  - '*/.mp4'
  - '*/.log'
  - '*/results/*'
